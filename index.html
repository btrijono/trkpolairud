<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map Julong</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .control-panel {
            position: absolute; top: 10px; left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px; z-index: 1000;
            border: 1px solid #ccc; border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            width: 300px; max-height: 90vh; overflow-y: auto;
        }
        h3 { margin: 0 0 10px 0; }
        input, button, select {
            width: 100%; padding: 8px; margin-bottom: 8px; box-sizing: border-box;
        }
        button {
            background: #0078A8; color: white; border: none; border-radius: 3px; cursor: pointer;
        }
        button:hover { background: #005f87; }
        .coord-input { display: flex; gap: 5px; }
        .coord-input input { flex: 1; }
        .points-list {
            margin-top: 10px; max-height: 200px; overflow-y: auto;
        }
        .point-item {
            padding: 5px; border-bottom: 1px solid #eee; cursor: pointer;
        }
        .point-item:hover { background: #f5f5f5; }
    </style>
</head>
<body>

<div class="control-panel">
    <h3>Plotting Titik</h3>
    <input type="text" id="point-name" placeholder="Nama Titik">
    <div class="coord-input">
        <input type="number" id="plot-lat-deg" placeholder="Lat °" min="-90" max="90" step="any">
        <input type="number" id="plot-lat-min" placeholder="Lat '" min="0" max="59" step="any">
        <input type="number" id="plot-lat-sec" placeholder="Lat &quot;" min="0" max="59" step="any">
    </div>
    <div class="coord-input">
        <input type="number" id="plot-lon-deg" placeholder="Lon °" min="-180" max="180" step="any">
        <input type="number" id="plot-lon-min" placeholder="Lon '" min="0" max="59" step="any">
        <input type="number" id="plot-lon-sec" placeholder="Lon &quot;" min="0" max="59" step="any">
    </div>
    <select id="plot-direction">
        <option value="N,E">Utara, Timur</option>
        <option value="S,E">Selatan, Timur</option>
        <option value="N,W">Utara, Barat</option>
        <option value="S,W">Selatan, Barat</option>
    </select>
    <button id="add-point">Tambah Titik</button>
    <button id="clear-points">Hapus Semua</button>
    <div class="points-list" id="points-list"></div>
</div>

<div id="map"></div>

<script>
    var map, pointsLayer = L.layerGroup(), pointsList = [];

    document.addEventListener('DOMContentLoaded', function() {
        // Inisialisasi peta
        map = L.map('map').setView([-0.7893, 113.9213], 8);

        // Base layer
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors', maxZoom: 19
        }).addTo(map);

        var googleSat = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            attribution: 'Google Satellite', maxZoom: 20
        });

        L.control.layers({ "OpenStreetMap": osm, "Google Satellite": googleSat }).addTo(map);
        pointsLayer.addTo(map);

        // Klik peta → isi form koordinat
        map.on('click', function(e) {
            var lat = e.latlng.lat;
            var lng = e.latlng.lng;
            var dms = convertDDToDMS(lat, lng);

            document.getElementById('plot-lat-deg').value = dms.latDeg;
            document.getElementById('plot-lat-min').value = dms.latMin;
            document.getElementById('plot-lat-sec').value = dms.latSec;
            document.getElementById('plot-lon-deg').value = dms.lonDeg;
            document.getElementById('plot-lon-min').value = dms.lonMin;
            document.getElementById('plot-lon-sec').value = dms.lonSec;

            var latDir = lat >= 0 ? 'N' : 'S';
            var lonDir = lng >= 0 ? 'E' : 'W';
            document.getElementById('plot-direction').value = latDir + ',' + lonDir;
        });

        // Event tombol
        document.getElementById("add-point").addEventListener("click", addPoint);
        document.getElementById("clear-points").addEventListener("click", clearPoints);
    });

    function convertDMSToDD(deg, min, sec, direction) {
        let dd = parseFloat(deg) + parseFloat(min)/60 + parseFloat(sec)/3600;
        if (direction === 'S' || direction === 'W') dd = -dd;
        return dd;
    }

    function convertDDToDMS(lat, lng) {
        const latAbs = Math.abs(lat);
        const latDeg = Math.floor(latAbs);
        const latMin = Math.floor((latAbs - latDeg) * 60);
        const latSec = ((latAbs - latDeg - latMin/60) * 3600).toFixed(2);

        const lngAbs = Math.abs(lng);
        const lngDeg = Math.floor(lngAbs);
        const lngMin = Math.floor((lngAbs - lngDeg) * 60);
        const lngSec = ((lngAbs - lngDeg - lngMin/60) * 3600).toFixed(2);

        return { latDeg, latMin, latSec, lonDeg: lngDeg, lonMin: lngMin, lonSec: lngSec };
    }

    function addPoint() {
        const name = document.getElementById('point-name').value.trim();
        const latDeg = parseFloat(document.getElementById('plot-lat-deg').value) || 0;
        const latMin = parseFloat(document.getElementById('plot-lat-min').value) || 0;
        const latSec = parseFloat(document.getElementById('plot-lat-sec').value) || 0;
        const lonDeg = parseFloat(document.getElementById('plot-lon-deg').value) || 0;
        const lonMin = parseFloat(document.getElementById('plot-lon-min').value) || 0;
        const lonSec = parseFloat(document.getElementById('plot-lon-sec').value) || 0;
        const direction = document.getElementById('plot-direction').value.split(',');

        if (!name) {
            alert("Nama titik harus diisi!");
            return;
        }

        const lat = convertDMSToDD(latDeg, latMin, latSec, direction[0]);
        const lng = convertDMSToDD(lonDeg, lonMin, lonSec, direction[1]);

        if (isNaN(lat) || isNaN(lng)) {
            alert("Koordinat tidak valid!");
            return;
        }

        const marker = L.marker([lat, lng]).addTo(pointsLayer);
        const dms = convertDDToDMS(lat, lng);
        const latDir = lat >= 0 ? 'N' : 'S';
        const lonDir = lng >= 0 ? 'E' : 'W';

        marker.bindPopup(`
            <b>${name}</b><br>
            Latitude: ${dms.latDeg}°${dms.latMin}'${dms.latSec}"${latDir}<br>
            Longitude: ${dms.lonDeg}°${dms.lonMin}'${dms.lonSec}"${lonDir}<br>
            Desimal: ${lat.toFixed(6)}, ${lng.toFixed(6)}
        `);

        pointsList.push({ name, coords: [lat, lng], marker });
        updatePointsList();
        document.getElementById('point-name').value = '';
    }

    function clearPoints() {
        pointsLayer.clearLayers();
        pointsList = [];
        updatePointsList();
    }

    function updatePointsList() {
        const listContainer = document.getElementById('points-list');
        listContainer.innerHTML = '';

        if (pointsList.length === 0) {
            listContainer.innerHTML = '<p>Tidak ada titik</p>';
            return;
        }

        pointsList.forEach(point => {
            const dms = convertDDToDMS(point.coords[0], point.coords[1]);
            const latDir = point.coords[0] >= 0 ? 'N' : 'S';
            const lonDir = point.coords[1] >= 0 ? 'E' : 'W';

            const pointElement = document.createElement('div');
            pointElement.className = 'point-item';
            pointElement.innerHTML = `
                <strong>${point.name}</strong><br>
                ${dms.latDeg}°${dms.latMin}'${dms.latSec}"${latDir}, 
                ${dms.lonDeg}°${dms.lonMin}'${dms.lonSec}"${lonDir}
            `;

            pointElement.addEventListener('click', () => {
                map.setView(point.coords, 16);
                point.marker.openPopup();
            });

            listContainer.appendChild(pointElement);
        });
    }
</script>
</body>
</html>
